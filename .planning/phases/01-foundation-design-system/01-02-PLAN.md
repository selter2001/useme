---
phase: 01-foundation-design-system
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .github/workflows/deploy.yml
  - .pa11yci.json
  - .gitignore
autonomous: false

must_haves:
  truths:
    - "GitHub Actions workflow deploys web/ directory to GitHub Pages on push to main"
    - "Pa11y WCAG2AA accessibility test runs before deployment and gates it"
    - "Dark mode color palette passes automated WCAG 4.5:1 contrast validation"
    - "Deployed site is accessible at the GitHub Pages URL"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment pipeline with accessibility testing"
      contains: "deploy-pages"
      min_lines: 40
    - path: ".pa11yci.json"
      provides: "Pa11y WCAG testing configuration"
      contains: "WCAG2AA"
    - path: ".gitignore"
      provides: "Git ignore rules for node_modules and build artifacts"
      contains: "node_modules"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "web/"
      via: "upload-pages-artifact path parameter"
      pattern: "path.*web"
    - from: ".github/workflows/deploy.yml"
      to: ".pa11yci.json"
      via: "pa11y-ci command"
      pattern: "pa11y-ci"
---

<objective>
Set up GitHub Actions CI/CD pipeline that runs automated WCAG accessibility testing and deploys the web directory to GitHub Pages.

Purpose: Ensures every deployment is automatically tested for accessibility compliance and prevents regressions. This infrastructure serves all future web projects deployed via GitHub Pages.

Output: Working deployment pipeline (.github/workflows/deploy.yml) with Pa11y WCAG gate, plus human verification of deployed result.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions deployment workflow and accessibility testing</name>
  <files>
    .github/workflows/deploy.yml
    .pa11yci.json
    .gitignore
  </files>
  <action>
    Create the deployment pipeline and supporting configuration:

    1. **.gitignore** — Standard ignores:
       - node_modules/
       - .DS_Store
       - *.log
       - .env

    2. **.github/workflows/deploy.yml** — Two-job workflow (follow RESEARCH.md GitHub Actions pattern):
       - Trigger: push to main branch + workflow_dispatch
       - Permissions: contents: read, pages: write, id-token: write
       - Concurrency group: "pages", cancel-in-progress: false

       **Job 1: test**
       - runs-on: ubuntu-latest
       - Steps:
         a) actions/checkout@v4
         b) actions/setup-node@v4 with node-version: '20', cache: 'npm'
         c) npm ci
         d) npm install -g pa11y-ci (global install for CI)
         e) Start http-server: `npx http-server web -p 8080 &` then `sleep 3`
         f) Run Pa11y: `pa11y-ci --config .pa11yci.json`

       **Job 2: deploy**
       - needs: test (only deploy if accessibility tests pass)
       - environment: name: github-pages, url: ${{ steps.deployment.outputs.page_url }}
       - runs-on: ubuntu-latest
       - Steps:
         a) actions/checkout@v4
         b) actions/configure-pages@v5
         c) actions/upload-pages-artifact@v3 with path: 'web' (deploy ONLY web directory)
            IMPORTANT: Also include shared/styles in the artifact. Since web/index.html references ../shared/styles/*, the deployment needs both directories. Use a pre-step to copy shared/styles INTO web/shared/styles/ so the web/ artifact is self-contained. This avoids the symlink issue (GitHub Pages artifact cannot contain symlinks per research).
            Alternatively: Create a build step that copies shared/styles to web/shared/styles before upload.
         d) actions/deploy-pages@v4

       **CRITICAL: Resolve shared styles for deployment.**
       The web/index.html references `../shared/styles/tokens.css` via relative paths. In local dev this works because shared/ is a sibling directory. But GitHub Pages deploys only the artifact directory. Solution:
       - Add a prepare step before upload: `mkdir -p web/shared/styles && cp shared/styles/*.css web/shared/styles/`
       - This copies shared CSS into web/ for the deployment artifact
       - web/index.html links will resolve correctly since `../shared/styles/` from web/index.html maps to `web/shared/styles/` relative to the web/ root when deployed

       Wait — `../shared/styles/` goes UP from web/, so if we deploy web/ as root, `../shared/styles/` would go ABOVE the root. That won't work.

       **Better solution:** In the deploy job, restructure for deployment:
       - Create a `_site/` directory
       - Copy `web/` contents into `_site/`
       - Copy `shared/` into `_site/shared/`
       - Upload `_site/` as the artifact
       This preserves the relative path relationship between web/index.html and ../shared/styles/.

       Updated deploy job steps:
         a) actions/checkout@v4
         b) Prepare deployment directory:
            ```
            mkdir -p _site
            cp -r web/* _site/
            cp -r shared _site/shared
            ```
         c) actions/configure-pages@v5
         d) actions/upload-pages-artifact@v3 with path: '_site'
         e) actions/deploy-pages@v4

    3. **.pa11yci.json** — Pa11y CI configuration (follow RESEARCH.md pattern):
       - defaults.standard: "WCAG2AA"
       - defaults.runners: ["htmlcs"] (use htmlcs only — axe runner requires separate npm package; keep simple)
       - defaults.chromeLaunchConfig.args: ["--no-sandbox", "--disable-setuid-sandbox"] (required for CI headless Chrome)
       - defaults.timeout: 10000
       - defaults.threshold: 0 (zero tolerance for errors)
       - defaults.includeNotices: false
       - defaults.includeWarnings: true
       - urls: ["http://localhost:8080/"]
  </action>
  <verify>
    1. `.github/workflows/deploy.yml` exists with two jobs (test + deploy)
    2. `deploy.yml` contains `actions/deploy-pages@v4`
    3. `deploy.yml` contains `pa11y-ci` command in test job
    4. `deploy.yml` contains `_site` directory preparation step
    5. `.pa11yci.json` has WCAG2AA standard configured
    6. `.gitignore` excludes node_modules

    Local Pa11y test (if Node.js available):
    7. `npm ci && npx http-server web -p 8080 &`
    8. `sleep 3 && npx pa11y-ci --config .pa11yci.json` — should pass or report specific WCAG issues to fix
  </verify>
  <done>
    - GitHub Actions workflow deploys _site/ (web + shared) to GitHub Pages
    - Pa11y WCAG2AA test gates deployment (deploy job depends on test job)
    - Deployment artifact includes shared/styles/ alongside web content
    - Relative path references from index.html to shared/styles/ resolve correctly in deployed structure
    - .gitignore prevents node_modules from being committed
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify design system and deployment pipeline</name>
  <what-built>
    Complete Phase 1 foundation:
    1. Monorepo with npm workspaces (shared/styles, web)
    2. Three-layer CSS design token system (primitives, semantic, component)
    3. Dark/tech themed test page using all design tokens
    4. GitHub Actions deployment pipeline with WCAG accessibility gate
  </what-built>
  <how-to-verify>
    **Local verification (immediate):**
    1. Run `npx http-server web -p 8080` from project root
    2. Open http://localhost:8080 in browser
    3. Verify: dark charcoal background (NOT pure black), readable off-white text
    4. Verify: neon green primary button with visible hover state
    5. Verify: cards with slightly elevated background
    6. Verify: tab through interactive elements — focus indicators visible on dark background
    7. Verify: resize browser — layout responds at tablet (768px) and desktop (1024px)
    8. Check browser console — NO 404 errors for stylesheets

    **Deployment verification (after first push to main):**
    9. Push to GitHub (if repo is connected) — check Actions tab for workflow run
    10. Verify Pa11y test job passes (green check)
    11. Verify deploy job succeeds and Pages URL shows the test page

    **If no GitHub remote yet:** Skip steps 9-11, deployment will be verified when remote is set up.
  </how-to-verify>
  <resume-signal>Type "approved" if the design system renders correctly, or describe any visual/functional issues to fix.</resume-signal>
</task>

</tasks>

<verification>
1. `.github/workflows/deploy.yml` contains two jobs: test (Pa11y) and deploy (Pages)
2. Deploy job creates `_site/` with web content + shared styles, preserving relative paths
3. Pa11y gates deployment — deploy only runs if test passes
4. `.pa11yci.json` enforces WCAG2AA with zero error threshold
5. Local `http-server` serves the test page correctly
6. Dark charcoal background renders (not pure black)
7. Text contrast is visually readable
8. Focus indicators are visible when tabbing through elements
</verification>

<success_criteria>
- GitHub Actions workflow file exists and is syntactically valid YAML
- Deployment pipeline includes WCAG accessibility gate (Pa11y) before deploy
- Deployment artifact includes both web content and shared styles
- Human verifies the test page renders the dark/tech theme correctly
- No broken stylesheet references in deployed or local version
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-02-SUMMARY.md`
</output>
