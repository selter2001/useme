---
phase: 03-habit-tracker
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - web/habit-tracker/index.html
  - web/habit-tracker/css/ios-mockup.css
  - web/habit-tracker/css/habit-tracker.css
  - web/habit-tracker/js/habit-tracker.js
  - web/habit-tracker/js/streak-calculator.js
  - web/habit-tracker/js/chart-renderer.js
  - web/index.html
  - .pa11yci.json
autonomous: true

must_haves:
  truths:
    - "Web demo displays habit tracker inside a CSS iPhone mockup frame"
    - "User can add a new habit with name, icon, and color in the web demo"
    - "User can check off habits and see streak counter update"
    - "User sees a weekly progress bar chart rendered with Chart.js"
    - "Habit data persists in localStorage across page reloads"
    - "Web demo uses dark/tech theme consistent with portfolio design tokens"
    - "Portfolio project card links to the web demo"
  artifacts:
    - path: "web/habit-tracker/index.html"
      provides: "Web demo page with iOS mockup container"
      contains: "iphone-mockup"
    - path: "web/habit-tracker/css/ios-mockup.css"
      provides: "CSS iPhone device frame"
      contains: "border-radius: 40px"
    - path: "web/habit-tracker/css/habit-tracker.css"
      provides: "App UI styles using design tokens"
      contains: "var(--color-"
    - path: "web/habit-tracker/js/habit-tracker.js"
      provides: "Core habit CRUD and UI logic"
      contains: "localStorage"
    - path: "web/habit-tracker/js/streak-calculator.js"
      provides: "JavaScript streak calculation"
      contains: "calculateStreak"
    - path: "web/habit-tracker/js/chart-renderer.js"
      provides: "Chart.js weekly/monthly chart"
      contains: "new Chart"
  key_links:
    - from: "web/habit-tracker/index.html"
      to: "shared/styles/tokens.css"
      via: "Stylesheet link for design tokens"
      pattern: "shared/styles/tokens\\.css"
    - from: "web/habit-tracker/js/habit-tracker.js"
      to: "web/habit-tracker/js/streak-calculator.js"
      via: "Calls calculateStreak for display"
      pattern: "calculateStreak"
    - from: "web/habit-tracker/js/habit-tracker.js"
      to: "web/habit-tracker/js/chart-renderer.js"
      via: "Calls renderChart for visualization"
      pattern: "renderChart"
    - from: "web/index.html"
      to: "web/habit-tracker/index.html"
      via: "Project card Demo link"
      pattern: "habit-tracker"
---

<objective>
Build the web demo that simulates the iOS Habit Tracker in a browser with CSS iPhone mockup, functional habit tracking with localStorage persistence, Chart.js progress visualization, and portfolio integration.

Purpose: Implements all web demo requirements (HABW-01, HABW-02, HABW-03) ‚Äî lets potential clients experience the app without Xcode, demonstrating full-stack capability.
Output: Functional web demo at web/habit-tracker/ with iOS mockup, habit CRUD, streak counter, and progress chart.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-habit-tracker/03-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create web demo HTML structure with CSS iPhone mockup and habit tracker styles</name>
  <files>
    web/habit-tracker/index.html
    web/habit-tracker/css/ios-mockup.css
    web/habit-tracker/css/habit-tracker.css
  </files>
  <action>
    **web/habit-tracker/index.html:**
    - DOCTYPE html, lang="pl"
    - Meta viewport, description ("Habit Tracker ‚Äî Web Demo. Aplikacja do sledzenia nawykow w przegladarce.")
    - Title: "Habit Tracker ‚Äî Web Demo | Wojciech Olszak"
    - Stylesheets: ../../shared/styles/reset.css, ../../shared/styles/tokens.css, ../../shared/styles/utilities.css, ./css/ios-mockup.css, ./css/habit-tracker.css
    - Scripts at bottom: Chart.js 4.x via CDN (https://cdn.jsdelivr.net/npm/chart.js@4), then ./js/streak-calculator.js, ./js/chart-renderer.js, ./js/habit-tracker.js (order matters ‚Äî dependencies first)
    - Skip-to-content link for accessibility
    - Page layout (two-column on desktop, stacked on mobile):
      - Left/top: Brief description heading "Habit Tracker" with subtitle "iOS App ‚Äî Web Demo" and short description paragraph explaining this simulates the iOS app. Add "Back to Portfolio" link (href="../").
      - Right/center: iPhone mockup container
    - iPhone mockup structure:
      ```html
      <div class="iphone-mockup">
        <div class="iphone-notch"></div>
        <div class="iphone-screen" id="app-screen">
          <!-- App content injected by JS -->
          <div class="app-header">
            <h1 class="app-title">My Habits</h1>
            <button class="app-add-btn" id="add-habit-btn" aria-label="Add habit">+</button>
          </div>
          <div class="habit-list" id="habit-list">
            <!-- Habits rendered by JS -->
          </div>
          <div class="empty-state" id="empty-state">
            <p>Tap + to add your first habit</p>
          </div>
        </div>
      </div>
      ```
    - Below mockup: Chart container (outside iPhone frame for readability on all screens)
      ```html
      <div class="chart-section" id="chart-section">
        <h3>Weekly Progress</h3>
        <canvas id="weeklyChart" width="400" height="200"></canvas>
      </div>
      ```
    - Add habit modal (hidden by default):
      ```html
      <div class="modal-overlay" id="add-modal" hidden>
        <div class="modal-content">
          <h2>New Habit</h2>
          <input type="text" id="habit-name-input" placeholder="Habit name" maxlength="30">
          <div class="icon-picker" id="icon-picker"><!-- Icons rendered by JS --></div>
          <div class="color-picker" id="color-picker"><!-- Colors rendered by JS --></div>
          <div class="modal-actions">
            <button class="modal-cancel" id="modal-cancel">Cancel</button>
            <button class="modal-save" id="modal-save" disabled>Save</button>
          </div>
        </div>
      </div>
      ```
    - Habit detail view (hidden by default, overlays habit list):
      ```html
      <div class="detail-view" id="detail-view" hidden>
        <button class="detail-back" id="detail-back">‚Üê Back</button>
        <div class="detail-header" id="detail-header"></div>
        <div class="detail-streaks" id="detail-streaks"></div>
        <div class="detail-chart">
          <canvas id="detailChart" width="300" height="150"></canvas>
        </div>
      </div>
      ```

    **web/habit-tracker/css/ios-mockup.css:**
    - .iphone-mockup: width 375px, height 812px (iPhone 14/15 aspect), background #000, border-radius 40px, padding 12px
    - box-shadow: 0 0 0 2px #1a1a1a, 0 0 0 6px #2a2a2a, 0 20px 60px rgba(0,0,0,0.8)
    - position relative, margin 0 auto
    - .iphone-notch: pseudo or div, position absolute, top 12px, centered, width 150px height 30px, background #000, border-radius 0 0 20px 20px, z-index 10
    - .iphone-screen: width/height 100%, background var(--color-bg-primary, #0E0E0E), border-radius 32px, overflow-y auto, overflow-x hidden, position relative
    - Responsive: @media (max-width: 768px) scale mockup to fit viewport using transform: scale(0.85) or width: 90vw with max-width 375px
    - Home indicator bar at bottom: thin rounded rectangle (134px x 5px) centered at bottom of screen

    **web/habit-tracker/css/habit-tracker.css:**
    - Use ONLY semantic design tokens from shared/styles/tokens.css (never primitives)
    - All var() references include fallback values per established pattern
    - .app-header: flex row, justify between, align center, padding, border-bottom with var(--color-border-default, #262626)
    - .app-title: font var(--font-size-xl, 1.25rem), color var(--color-text-primary, #F9FAFB)
    - .app-add-btn: 36px circle, background var(--color-interactive-primary, #22C55E), color #000, font-size 1.5rem, border-radius 50%
    - .habit-item: flex row, padding var(--spacing-md, 1rem), border-bottom, align center, cursor pointer, transition background
    - .habit-item:hover / .habit-item:active: background var(--color-bg-secondary, #1A1A1A)
    - .habit-icon: 40px circle background, centered icon text (emoji), margin-right
    - .habit-info: flex column, flex 1
    - .habit-name: font var(--font-size-md, 1rem), color var(--color-text-primary, #F9FAFB)
    - .habit-streak: font var(--font-size-sm, 0.875rem), color var(--color-text-secondary, #9CA3AF), with flame emoji prefix
    - .habit-check: 28px circle, border 2px solid, toggles between empty and filled (checkmark)
    - .habit-check.completed: background var(--color-interactive-primary, #22C55E), border-color same
    - .empty-state: centered, padding-top 40%, color var(--color-text-muted, #6B7280)
    - Modal styles: overlay with backdrop, centered content card, input styling matching dark theme
    - .chart-section: margin-top var(--spacing-xl, 2rem), padding, background var(--color-bg-secondary, #1A1A1A), border-radius var(--border-radius-lg, 12px)
    - Detail view styles matching iOS detail page
    - Color classes for habit accents: .habit-color-green, .habit-color-blue, .habit-color-orange, .habit-color-purple, .habit-color-red, .habit-color-yellow

    **Page layout (outside mockup):**
    - body: background var(--color-bg-primary, #0E0E0E)
    - .page-layout: max-width 1200px, margin auto, padding, display grid with two columns on desktop (1fr 1fr), single column on mobile
    - .page-info: description text, back link styled as var(--color-interactive-primary, #22C55E) underline
  </action>
  <verify>
    - ls web/habit-tracker/index.html web/habit-tracker/css/ios-mockup.css web/habit-tracker/css/habit-tracker.css
    - grep "shared/styles/tokens.css" web/habit-tracker/index.html (design token link exists)
    - grep "chart.js@4" web/habit-tracker/index.html (Chart.js CDN included)
    - grep "iphone-mockup" web/habit-tracker/css/ios-mockup.css
    - grep -c "var(--" web/habit-tracker/css/habit-tracker.css (should be 15+ semantic token references)
  </verify>
  <done>
    Web demo HTML page exists with proper structure: iPhone CSS mockup frame, habit list area, add-habit modal, detail view, chart container. All styles use semantic design tokens with fallbacks. Chart.js loaded via CDN.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement JavaScript logic with localStorage persistence and Chart.js visualization</name>
  <files>
    web/habit-tracker/js/streak-calculator.js
    web/habit-tracker/js/chart-renderer.js
    web/habit-tracker/js/habit-tracker.js
  </files>
  <action>
    **js/streak-calculator.js:**
    - Self-contained module (no imports needed, loaded before habit-tracker.js)
    - const StreakCalculator = { ... } (namespace object)
    - Method calculateStreak(completions):
      1. Filter to done status completions
      2. Normalize dates to start-of-day: new Date(d).setHours(0,0,0,0)
      3. Deduplicate dates, sort descending
      4. Walk consecutive: if diff == 86400000ms (1 day), increment streak; else reset
      5. Current streak valid only if most recent is today or yesterday
      6. Return { current, longest }
    - Method getWeeklyData(completions):
      1. Build array of last 7 days
      2. For each day, count .done completions
      3. Return { labels: ['Mon','Tue',...], data: [1,0,1,...] }
    - Method getMonthlyData(completions):
      1. Build array of last 30 days
      2. For each day, check if completed
      3. Return array of { date, completed } objects

    **js/chart-renderer.js:**
    - const ChartRenderer = { ... } (namespace object)
    - Property: currentChart (reference to active Chart instance, for destroy before re-render)
    - Method renderWeeklyChart(canvasId, weeklyData, accentColor):
      1. Get canvas context
      2. If currentChart, destroy it (prevent canvas reuse error)
      3. Create new Chart with type 'bar'
      4. Data: labels from weeklyData.labels, datasets[0].data from weeklyData.data
      5. backgroundColor: accentColor or '#22C55E'
      6. Options: responsive true, maintainAspectRatio false, scales.y beginAtZero + stepSize 1, plugins.legend display false
      7. Dark theme: scales.x.ticks.color '#9CA3AF', scales.y.ticks.color '#9CA3AF', scales.x.grid.color 'rgba(255,255,255,0.05)', scales.y.grid.color 'rgba(255,255,255,0.05)'
      8. borderRadius 4 on bars
      9. Store reference to currentChart
    - Method renderDetailChart(canvasId, monthlyData, accentColor):
      Similar but for 30-day view in detail panel

    **js/habit-tracker.js:**
    - const HabitTracker = { ... } (main app namespace)
    - **Data model:**
      ```javascript
      // Habit: { id, name, icon, color, createdAt, completions: [{date, status}] }
      ```
    - **Storage (HabitStorage):**
      - save(habits): localStorage.setItem('habitTrackerData', JSON.stringify({ version: 1, habits, lastUpdated: new Date().toISOString() }))
      - load(): parse from localStorage with try/catch, validate version, return { habits: [] } on error
      - Versioned schema with migration stub
    - **State:** habits array (loaded from storage on init)
    - **Available icons:** Array of emoji icons: ['üèÉ', 'üìñ', 'üíß', 'üåô', '‚ù§Ô∏è', 'üí™', 'üç¥', 'üé®', 'üéµ', 'üéì', 'üåø', '‚≠ê']
    - **Available colors:** Array of {name, hex}: [{name:'green', hex:'#22C55E'}, {name:'blue', hex:'#3A82FF'}, {name:'orange', hex:'#F97316'}, {name:'purple', hex:'#A855F7'}, {name:'red', hex:'#EF4444'}, {name:'yellow', hex:'#EAB308'}]
    - **init():**
      1. Load habits from storage
      2. Render habit list
      3. Bind event listeners (add button, modal save/cancel)
      4. Render weekly chart for all habits combined
      5. Show/hide empty state based on habits.length
    - **renderHabitList():**
      1. Clear habit-list container
      2. For each habit: create .habit-item div with icon, name, streak badge (if > 0), checkoff button
      3. Checkoff button: filled if completed today, empty otherwise
      4. Click on checkoff: toggleCompletion(habitId)
      5. Click on habit row (not checkoff): showDetail(habitId)
      6. Toggle empty state visibility
    - **toggleCompletion(habitId):**
      1. Find habit by id
      2. Check if today's completion exists
      3. If yes, remove it; if no, add { date: new Date().toISOString(), status: 'done' }
      4. Save to storage
      5. Re-render list and chart
    - **showAddModal():**
      1. Show #add-modal (remove hidden)
      2. Render icon picker grid (12 emoji choices, tappable)
      3. Render color picker (6 color circles, tappable)
      4. Focus name input
      5. Bind save: validate name not empty, create habit { id: Date.now(), name, icon, color, createdAt, completions: [] }
      6. On save: push to habits, save storage, re-render, close modal
    - **showDetail(habitId):**
      1. Find habit
      2. Hide habit list, show detail-view
      3. Render header with icon + name
      4. Compute streak via StreakCalculator.calculateStreak(habit.completions)
      5. Render streak badges (current + longest)
      6. Render detail chart via ChartRenderer.renderDetailChart()
      7. Back button: hide detail, show habit list
    - **deleteHabit(habitId):** (long-press or swipe simulation ‚Äî use a delete button in detail view)
      1. Confirm with user (window.confirm)
      2. Filter out habit from array
      3. Save, re-render, go back to list
    - **DOMContentLoaded:** Call HabitTracker.init()

    **Pre-populated demo data:**
    - On first load (no localStorage data), seed with 3 example habits:
      1. "Morning Run" (üèÉ, green) with 5 days of completions (demonstrates streak)
      2. "Read 30min" (üìñ, blue) with 3 scattered completions
      3. "Drink Water" (üíß, purple) with 7 days of completions (full week streak)
    - This ensures the demo looks populated when potential clients first visit
  </action>
  <verify>
    - ls web/habit-tracker/js/streak-calculator.js web/habit-tracker/js/chart-renderer.js web/habit-tracker/js/habit-tracker.js
    - grep "calculateStreak" web/habit-tracker/js/streak-calculator.js
    - grep "new Chart" web/habit-tracker/js/chart-renderer.js
    - grep "localStorage" web/habit-tracker/js/habit-tracker.js
    - grep "version: 1" web/habit-tracker/js/habit-tracker.js (versioned storage)
  </verify>
  <done>
    Fully functional web demo: habits with CRUD, daily checkoff toggle, streak calculation updating in real-time, Chart.js weekly bar chart, localStorage persistence with versioned schema, and pre-populated demo data for first-time visitors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update portfolio project card link and accessibility config</name>
  <files>
    web/index.html
    .pa11yci.json
  </files>
  <action>
    **web/index.html:**
    - Find the Habit Tracker project card (around line 140-158)
    - Update the Demo link from href="#" to href="habit-tracker/" (relative path within web/)
    - Keep the GitHub link as "#" (will be updated in Phase 5 integration)
    - Update the project description if needed to match actual implementation

    **.pa11yci.json:**
    - Add "http://localhost:8080/web/habit-tracker/" to the urls array
    - This ensures the web demo passes WCAG2AA accessibility gate before deployment

    **Verify both pages load correctly:**
    - Start http-server from project root: npx http-server . -p 8080
    - Check http://localhost:8080/web/ loads portfolio
    - Check http://localhost:8080/web/habit-tracker/ loads web demo
    - Kill server after check
  </action>
  <verify>
    - grep "habit-tracker/" web/index.html (Demo link updated)
    - grep "habit-tracker" .pa11yci.json (accessibility URL added)
    - npx http-server . -p 8080 & sleep 2 && curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/web/habit-tracker/ && kill %1 (returns 200)
  </verify>
  <done>
    Portfolio Habit Tracker project card links to working web demo. Pa11y accessibility config includes the new page for WCAG2AA testing in CI pipeline.
  </done>
</task>

</tasks>

<verification>
1. web/habit-tracker/ directory contains index.html, css/ (2 files), js/ (3 files)
2. index.html links to ../../shared/styles/tokens.css and Chart.js CDN
3. CSS uses only semantic tokens (no primitive references) with fallback values
4. JavaScript provides full CRUD: add, delete, daily checkoff, streak display
5. localStorage persistence with versioned schema and migration stub
6. Pre-populated demo data appears on first visit
7. Chart.js renders weekly bar chart with dark theme styling
8. Portfolio project card Demo link points to habit-tracker/
9. .pa11yci.json includes habit-tracker URL
10. Page accessible at http://localhost:8080/web/habit-tracker/
</verification>

<success_criteria>
Web demo at web/habit-tracker/ displays functional habit tracker inside CSS iPhone mockup with dark/tech theme, habit CRUD with localStorage persistence, real-time streak counter, and Chart.js progress visualization. Portfolio project card links directly to the demo.
</success_criteria>

<output>
After completion, create `.planning/phases/03-habit-tracker/03-03-SUMMARY.md`
</output>
