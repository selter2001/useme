---
phase: 03-habit-tracker
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ios/HabitTracker/HabitTrackerApp.swift
  - ios/HabitTracker/Models/Habit.swift
  - ios/HabitTracker/Models/HabitCompletion.swift
  - ios/HabitTracker/Views/HabitListView.swift
  - ios/HabitTracker/Views/AddHabitView.swift
  - ios/HabitTracker/Views/Components/HabitRow.swift
autonomous: true

must_haves:
  truths:
    - "User can see a list of created habits"
    - "User can add a new habit with name, icon, and color"
    - "User can edit an existing habit's name, icon, or color"
    - "User can delete a habit (with cascading deletion of completions)"
    - "User can check off a habit as done for today"
    - "Habit data persists across app restarts via SwiftData"
  artifacts:
    - path: "ios/HabitTracker/HabitTrackerApp.swift"
      provides: "App entry point with ModelContainer"
      contains: "modelContainer(for:"
    - path: "ios/HabitTracker/Models/Habit.swift"
      provides: "Habit data model with @Model macro"
      contains: "@Model"
    - path: "ios/HabitTracker/Models/HabitCompletion.swift"
      provides: "Daily completion record model"
      contains: "@Model"
    - path: "ios/HabitTracker/Views/HabitListView.swift"
      provides: "Main habit list with @Query and CRUD"
      contains: "@Query"
    - path: "ios/HabitTracker/Views/AddHabitView.swift"
      provides: "Create and edit habit form"
      contains: "modelContext"
    - path: "ios/HabitTracker/Views/Components/HabitRow.swift"
      provides: "Habit list row with today's checkoff toggle"
      contains: "HabitRow"
  key_links:
    - from: "ios/HabitTracker/HabitTrackerApp.swift"
      to: "Habit.self, HabitCompletion.self"
      via: "modelContainer registration"
      pattern: "modelContainer.*Habit\\.self"
    - from: "ios/HabitTracker/Views/HabitListView.swift"
      to: "ios/HabitTracker/Models/Habit.swift"
      via: "@Query fetching Habit objects"
      pattern: "@Query.*Habit"
    - from: "ios/HabitTracker/Views/Components/HabitRow.swift"
      to: "ios/HabitTracker/Models/HabitCompletion.swift"
      via: "Toggle today's completion status"
      pattern: "completions"
---

<objective>
Build the iOS Habit Tracker app foundation: SwiftData models with relationships, main list view with reactive @Query, add/edit form, and daily habit checkoff toggle.

Purpose: Implements core CRUD operations (HABT-01), daily checkoff (HABT-02), and SwiftData persistence (HABT-05) — the foundation all other iOS features build on.
Output: Runnable iOS app in Xcode with habit list, add/edit/delete, and daily completion toggle.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-habit-tracker/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project structure with SwiftData models</name>
  <files>
    ios/HabitTracker/HabitTrackerApp.swift
    ios/HabitTracker/Models/Habit.swift
    ios/HabitTracker/Models/HabitCompletion.swift
  </files>
  <action>
    Create the iOS project directory structure at ios/HabitTracker/.

    **HabitTrackerApp.swift:**
    - Import SwiftUI and SwiftData
    - @main struct with WindowGroup scene
    - Register modelContainer(for: [Habit.self, HabitCompletion.self])
    - Root view: HabitListView()

    **Models/Habit.swift:**
    - Import SwiftData and Foundation
    - @Model final class Habit with properties:
      - var name: String
      - var icon: String (SF Symbol name, e.g. "figure.run", "book.fill", "drop.fill")
      - var color: String (hex color string for UI accent)
      - var createdAt: Date (default: Date())
      - @Relationship(deleteRule: .cascade) var completions: [HabitCompletion] (default: [])
    - init(name:icon:color:) that sets createdAt = Date() and completions = []
    - Computed property `isCompletedToday: Bool` that checks if completions contains an entry where Calendar.current.isDate(completion.date, inSameDayAs: Date()) and status == .done
    - Method `toggleToday(context: ModelContext)` that either adds a new HabitCompletion(date: Date(), status: .done) or removes the existing today's completion

    **Models/HabitCompletion.swift:**
    - Import SwiftData and Foundation
    - enum CompletionStatus: String, Codable { case done, missed, skipped }
    - @Model final class HabitCompletion with properties:
      - var date: Date
      - var statusRaw: String (stored value)
      - Computed var status: CompletionStatus (get/set from statusRaw)
    - init(date: Date, status: CompletionStatus)
    - Use statusRaw string storage because SwiftData handles String natively; enum needs Codable bridging

    **Important:** No ViewModel layer. SwiftData @Model classes are automatically Observable. Use @Query directly in views per research findings.
  </action>
  <verify>
    Files exist at expected paths:
    - ls ios/HabitTracker/HabitTrackerApp.swift
    - ls ios/HabitTracker/Models/Habit.swift
    - ls ios/HabitTracker/Models/HabitCompletion.swift
    All files import SwiftData. Habit.swift contains @Relationship(deleteRule: .cascade).
  </verify>
  <done>
    Three Swift files exist with @Model classes for Habit and HabitCompletion, proper relationship with cascade delete, and app entry point registering both models in modelContainer.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build habit list view, add/edit form, and daily checkoff row</name>
  <files>
    ios/HabitTracker/Views/HabitListView.swift
    ios/HabitTracker/Views/AddHabitView.swift
    ios/HabitTracker/Views/Components/HabitRow.swift
  </files>
  <action>
    **Views/HabitListView.swift:**
    - Import SwiftUI and SwiftData
    - @Query(sort: \Habit.createdAt, order: .reverse) private var habits: [Habit]
    - @Environment(\.modelContext) private var modelContext
    - @State private var showingAddHabit = false
    - @State private var habitToEdit: Habit? = nil
    - NavigationStack with List of habits using ForEach
    - Each habit row: NavigationLink to HabitDetailView(habit:) wrapping HabitRow(habit:)
    - .onDelete(perform: deleteHabits) for swipe-to-delete
    - Toolbar "+" button sets showingAddHabit = true
    - .sheet(isPresented: $showingAddHabit) { AddHabitView() }
    - .sheet(item: $habitToEdit) { habit in AddHabitView(habitToEdit: habit) }
    - navigationTitle("My Habits")
    - Empty state: When habits.isEmpty, show centered text "Tap + to add your first habit" with a large plus icon

    **Views/AddHabitView.swift:**
    - Import SwiftUI and SwiftData
    - @Environment(\.modelContext) private var modelContext
    - @Environment(\.dismiss) private var dismiss
    - Optional var habitToEdit: Habit? (nil = create mode, non-nil = edit mode)
    - @State properties: name (String), selectedIcon (String), selectedColor (String)
    - .onAppear: if habitToEdit != nil, populate @State from existing habit
    - Icon picker: Grid of 12 SF Symbol choices (figure.run, book.fill, drop.fill, moon.fill, heart.fill, dumbbell.fill, fork.knife, paintbrush.fill, music.note, graduationcap.fill, leaf.fill, star.fill)
    - Color picker: Grid of 6 color options (green, blue, orange, purple, red, yellow) as tappable circles
    - Save button: if editing, update existing habit properties; if creating, insert new Habit into modelContext
    - Cancel button in toolbar
    - Validate: name must not be empty (disable Save button if empty)

    **Views/Components/HabitRow.swift:**
    - Import SwiftUI and SwiftData
    - Takes Habit as parameter
    - @Environment(\.modelContext) private var modelContext
    - Horizontal layout: icon (SF Symbol in habit.color) | habit name | spacer | checkmark button
    - Checkmark button: filled circle if isCompletedToday, empty circle otherwise
    - Tapping checkmark calls habit.toggleToday(context: modelContext)
    - Use .sensoryFeedback(.impact, trigger:) for haptic on toggle (iOS 17+)
    - Show habit.color as the accent tint for icon and checkmark

    **Color handling:** Store colors as string keys ("green", "blue", etc.) and map to SwiftUI Color in a helper extension or computed property.
  </action>
  <verify>
    Files exist at expected paths:
    - ls ios/HabitTracker/Views/HabitListView.swift
    - ls ios/HabitTracker/Views/AddHabitView.swift
    - ls ios/HabitTracker/Views/Components/HabitRow.swift
    HabitListView contains @Query. AddHabitView contains modelContext.insert. HabitRow contains toggleToday.
  </verify>
  <done>
    Complete CRUD UI: list view with reactive @Query showing all habits sorted by creation date, add/edit sheet with icon and color picker, swipe-to-delete, and daily checkoff toggle with haptic feedback. App is runnable in Xcode Simulator.
  </done>
</task>

</tasks>

<verification>
1. All 6 Swift files exist in ios/HabitTracker/ directory structure
2. HabitTrackerApp.swift registers both Habit.self and HabitCompletion.self in modelContainer
3. Habit.swift uses @Model and @Relationship(deleteRule: .cascade)
4. HabitListView.swift uses @Query for reactive data fetching
5. No ViewModel classes — direct SwiftData integration per modern pattern
6. AddHabitView supports both create and edit modes via optional habitToEdit parameter
</verification>

<success_criteria>
iOS Habit Tracker project exists with working SwiftData models, habit list with add/edit/delete, and daily checkoff toggle. The app structure follows modern SwiftUI + SwiftData patterns without MVVM ViewModel layer.
</success_criteria>

<output>
After completion, create `.planning/phases/03-habit-tracker/03-01-SUMMARY.md`
</output>
