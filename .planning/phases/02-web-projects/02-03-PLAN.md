---
phase: 02-web-projects
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - .github/workflows/deploy.yml
  - .pa11yci.json
  - package.json
autonomous: false

must_haves:
  truths:
    - "Deploy workflow copies both web/ and landing/ directories to _site/ alongside shared/"
    - "Root index.html redirect still points to web/ (portfolio as primary)"
    - "Pa11y tests run against both /web/ and /landing/ URLs for WCAG2AA compliance"
    - "Landing page is accessible at /landing/ path after deployment"
    - "Both sites render correctly with dark/tech theme in a browser"
    - "Both sites are responsive on mobile viewport"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "Updated deployment pipeline for both sites"
      contains: "landing"
    - path: ".pa11yci.json"
      provides: "WCAG testing for both portfolio and landing page"
      contains: "landing"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "_site/landing/"
      via: "cp -r landing/* _site/landing/"
      pattern: "landing"
    - from: ".pa11yci.json"
      to: "http://localhost:8080/landing/"
      via: "URL configuration"
      pattern: "localhost:8080/landing"
    - from: "web/index.html"
      to: "landing/index.html"
      via: "cross-site navigation links"
      pattern: "../landing/"
---

<objective>
Update the GitHub Actions deployment pipeline and Pa11y accessibility configuration to deploy and test both the portfolio website and landing page. Then visually verify both sites render correctly.

Purpose: Both sites must be deployed together to GitHub Pages and gated by WCAG accessibility testing. Without this update, only the portfolio would deploy and the landing page would be inaccessible.
Output: Updated deploy.yml and .pa11yci.json supporting both sites, verified working via local server.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-web-projects/02-01-SUMMARY.md
@.planning/phases/02-web-projects/02-02-SUMMARY.md
@.planning/phases/01-foundation-design-system/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update deployment pipeline and accessibility tests for both sites</name>
  <files>.github/workflows/deploy.yml, .pa11yci.json, package.json</files>
  <action>
**Update .github/workflows/deploy.yml:**

Modify the deploy job's "Prepare deployment directory" step to also copy the landing page:

```yaml
- name: Prepare deployment directory
  run: |
    mkdir -p _site/web _site/landing
    cp -r web/* _site/web/
    cp -r landing/* _site/landing/
    cp -r shared _site/shared
    cat > _site/index.html << 'REDIRECT'
    <!DOCTYPE html>
    <html><head><meta http-equiv="refresh" content="0;url=web/"></head></html>
    REDIRECT
```

The only change is adding `_site/landing` mkdir and `cp -r landing/* _site/landing/`. Everything else stays the same.

Also update the test job to ensure it runs against both sites. The http-server already serves from root (`.`), so both /web/ and /landing/ are accessible. No changes needed to the server step.

**Update .pa11yci.json:**

Add the landing page URL to the urls array:

```json
{
  "defaults": {
    "standard": "WCAG2AA",
    "runners": ["htmlcs"],
    "chromeLaunchConfig": {
      "args": ["--no-sandbox", "--disable-setuid-sandbox"]
    },
    "timeout": 10000,
    "threshold": 0,
    "includeNotices": false,
    "includeWarnings": true
  },
  "urls": [
    "http://localhost:8080/web/",
    "http://localhost:8080/landing/"
  ]
}
```

**Update package.json (root):**

Add the landing workspace to the workspaces array. Current workspaces: `["shared/styles", "web", "ios-demo"]`. Add "landing":

```json
"workspaces": ["shared/styles", "web", "landing", "ios-demo"]
```

Also add a convenience dev script for the landing page:
- Keep existing `dev:web` script
- Add `dev:landing` that's the same server command (serves from root, both sites accessible)

**Then run `npm install`** to register the new landing workspace.

**Verify locally:**
1. Start http-server: `npx http-server . -p 8080`
2. Curl both pages to confirm they load: `curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/web/` and `curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/landing/`
3. Both should return 200
4. Kill the server

**Critical rules:**
- Do NOT change the deploy workflow structure (two jobs: test -> deploy)
- Root redirect still goes to web/ (portfolio is primary page)
- http-server serves from project root (.) — this was a key decision from Phase 1
  </action>
  <verify>
Verify with:
1. `grep 'landing' .github/workflows/deploy.yml` — should find landing directory copy step
2. `grep 'landing' .pa11yci.json` — should find landing URL
3. `grep 'landing' package.json` — should find landing in workspaces
4. Start server and test both pages:
   - `npx http-server . -p 8080 &`
   - `sleep 2`
   - `curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/web/` — expect 200
   - `curl -s -o /dev/null -w "%{http_code}" http://localhost:8080/landing/` — expect 200
   - Kill server
5. `node -e "const pkg = require('./package.json'); console.log(pkg.workspaces.includes('landing'))"` — should print true
  </verify>
  <done>deploy.yml copies both web/ and landing/ to _site/ for GitHub Pages deployment. .pa11yci.json tests both /web/ and /landing/ URLs for WCAG2AA compliance. package.json includes landing in workspaces. Both sites return HTTP 200 from local server.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of both sites</name>
  <what-built>
Complete portfolio website and service landing page, both using the shared dark/tech design system, with responsive layouts and full accessibility structure.
  </what-built>
  <how-to-verify>
Start the local dev server:
```bash
cd /Users/wojciecholszak/Desktop/useme && npx http-server . -p 8080
```

**1. Portfolio (http://localhost:8080/web/):**
- [ ] Page loads with dark/tech theme (charcoal background, not pure black)
- [ ] Navigation bar visible at top with "WO" logo and section links
- [ ] Hero section shows name "Wojciech Olszak", subtitle, avatar placeholder, CTA buttons
- [ ] "O mnie" section shows bio text and skill pills (SwiftUI, HTML/CSS/JS, Claude Code, etc.)
- [ ] "Projekty" section shows 4 project cards in a responsive grid
- [ ] Each card has title, description, tech pills, and demo/GitHub buttons
- [ ] "Kontakt" section has Useme profile link and email link
- [ ] Footer shows copyright and "Zbudowane z Claude Code"
- [ ] Resize window to mobile width — layout becomes single column
- [ ] Navigation hamburger menu appears on mobile (if applicable)

**2. Landing Page (http://localhost:8080/landing/):**
- [ ] Page loads with same dark/tech theme as portfolio
- [ ] Hero has clear service headline and "Zamów bezpłatną wycenę" CTA
- [ ] Services section shows 3 service cards (Strony internetowe, Aplikacje iOS, AI-Powered)
- [ ] Testimonials shows 3 client quotes with names
- [ ] Contact form has 3 fields: name, email, message
- [ ] Click into name field, leave empty, tab out → error message appears below
- [ ] Type invalid email, tab out → email format error appears
- [ ] Type short message (<10 chars), tab out → minimum length error appears
- [ ] Fix all errors → error messages disappear
- [ ] Submit form → loading state shows (will fail EmailJS call since keys are placeholder — that's expected)
- [ ] Resize to mobile — layout becomes single column, form stays usable

**3. Cross-site links:**
- [ ] Portfolio footer or nav has link to landing page (or vice versa)
- [ ] Landing page has "Zobacz Portfolio" link to ../web/
  </how-to-verify>
  <resume-signal>Type "approved" to confirm both sites look correct, or describe any visual/functional issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. deploy.yml copies web/, landing/, and shared/ to _site/
2. .pa11yci.json tests both /web/ and /landing/
3. Both sites return HTTP 200 from local server
4. Human confirms dark/tech theme renders correctly on both sites
5. Human confirms responsive layout works on mobile viewport
6. Human confirms form validation produces inline errors on blur
</verification>

<success_criteria>
- Both sites deploy via the same GitHub Actions pipeline
- Both sites pass WCAG2AA accessibility gate via Pa11y
- Human visually approves both sites' appearance and responsiveness
- Contact form inline validation works (errors appear/disappear on blur)
- Cross-site navigation works between portfolio and landing page
</success_criteria>

<output>
After completion, create `.planning/phases/02-web-projects/02-03-SUMMARY.md`
</output>
